{"version":3,"sources":["../src/index.jsx"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react'\nimport PropTypes from 'prop-types'\n\nconst DefaultCanvasSize = 16\nconst linkElements = []\n\nconst drawAlert = (context, { fillColor, text, textColor, canvasSize }) => {\n  // Allow same looking padding over differents iconSizes\n  const Padding = canvasSize / 5\n  // Allow readable text across differnts iconSizes\n  context.font = `bold ${canvasSize - Padding * 2}px arial`\n\n  const w =\n    Math.min(\n      // Take the text with if it's smaller than available space (eg: '2')\n      context.measureText(text).width,\n      // Or take the maximum size we'll force our text to fit in anyway (eg: '1000000')\n      canvasSize - Padding\n    ) + Padding\n\n  const x = canvasSize - w\n  const y = canvasSize / 2 - Padding\n  const h = Padding + canvasSize / 2\n  const r = Math.min(w / 2, h / 2)\n\n  context.beginPath()\n  context.moveTo(x + r, y)\n  context.arcTo(x + w, y, x + w, y + h, r)\n  context.arcTo(x + w, y + h, x, y + h, r)\n  context.arcTo(x, y + h, x, y, r)\n  context.arcTo(x, y, x + w, y, r)\n  context.closePath()\n  context.fillStyle = fillColor\n  context.fill()\n  context.fillStyle = textColor\n  context.textBaseline = 'bottom'\n  context.textAlign = 'right'\n  context.fillText(\n    text,\n    canvasSize - Padding / 2,\n    canvasSize,\n    // This will prevent the text from going outside the favicon, instead it'll squeeze his with to fit in\n    canvasSize - Padding\n  )\n}\n\nconst drawIcon = ({\n  alertCount,\n  alertFillColor,\n  alertTextColor,\n  callback,\n  renderOverlay,\n  url: src,\n  canvasSize,\n}) => {\n  const img = document.createElement('img')\n  img.crossOrigin = 'Anonymous'\n  img.onload = function () {\n    const canvas = document.createElement('canvas')\n    canvas.width = canvasSize\n    canvas.height = canvasSize\n\n    const context = canvas.getContext('2d')\n    context.clearRect(0, 0, img.width, img.height)\n    context.drawImage(img, 0, 0, canvas.width, canvas.height)\n\n    if (alertCount) {\n      drawAlert(context, {\n        fillColor: alertFillColor,\n        textColor: alertTextColor,\n        text: alertCount,\n        canvasSize,\n      })\n    }\n\n    if (renderOverlay) {\n      renderOverlay(canvas, context)\n    }\n    callback(context.canvas.toDataURL())\n  }\n  img.src = src\n}\n\nconst updateHtmlIconLink = (keepIconLink) => {\n  if (typeof document === 'undefined') {\n    return\n  }\n\n  if (linkElements.length === 0) {\n    var head = document.getElementsByTagName('head')[0]\n\n    const linkEl = document.createElement('link')\n    linkEl.type = 'image/x-icon'\n    linkEl.rel = 'icon'\n\n    const linkApple = document.createElement('link')\n    linkApple.rel = 'apple-touch-icon'\n\n    linkElements.push(linkEl, linkApple)\n\n    // remove existing favicons\n    var links = head.getElementsByTagName('link')\n    for (var i = links.length; --i >= 0; ) {\n      if (\n        /\\bicon\\b/i.test(links[i].getAttribute('rel')) &&\n        !keepIconLink(links[i])\n      ) {\n        head.removeChild(links[i])\n      }\n    }\n\n    linkElements.forEach((el) => head.appendChild(el))\n  }\n}\n\nconst Favicon = ({\n  iconSize,\n  alertCount,\n  alertFillColor,\n  alertTextColor,\n  animated,\n  animationDelay,\n  keepIconLink,\n  renderOverlay,\n  url,\n}) => {\n  const animationIndex = useRef(0)\n  const animationTickIntervalId = useRef(null)\n\n  const [, updateState] = useState()\n  const forceUpdate = useCallback(() => updateState({}), [])\n\n  const onAnimationTick = useCallback(() => {\n    updateHtmlIconLink(keepIconLink)\n    animationIndex.current = (animationIndex.current + 1) % url.length\n    forceUpdate()\n  }, [forceUpdate, keepIconLink, url])\n\n  // Perform initial favicon update\n  useEffect(() => {\n    onAnimationTick()\n  }, [onAnimationTick])\n\n  const isAnimated = url instanceof Array && animated\n\n  useEffect(() => {\n    if (isAnimated) {\n      if (!animationTickIntervalId.current) {\n        const intervalId = setInterval(onAnimationTick, animationDelay)\n        animationTickIntervalId.current = intervalId\n      }\n    } else {\n      if (animationTickIntervalId.current) {\n        clearInterval(animationTickIntervalId.current)\n        animationTickIntervalId.current = null\n        updateHtmlIconLink(keepIconLink)\n      }\n    }\n  }, [animationDelay, isAnimated, keepIconLink, onAnimationTick, url])\n\n  const currentUrl = isAnimated\n    ? url[animationIndex.current]\n    : url instanceof Array\n    ? url[0]\n    : url\n\n  if (alertCount || renderOverlay) {\n    drawIcon({\n      alertCount,\n      alertFillColor,\n      alertTextColor,\n      callback: (url) => {\n        linkElements.forEach((el) => (el.href = url))\n      },\n      renderOverlay,\n      url: currentUrl,\n      canvasSize: iconSize,\n    })\n  } else {\n    linkElements.forEach((el) => (el.href = currentUrl))\n  }\n\n  return null\n}\n\nFavicon.defaultProps = {\n  iconSize: DefaultCanvasSize,\n  alertCount: null,\n  alertFillColor: 'red',\n  alertTextColor: 'white',\n  animated: true,\n  animationDelay: 500,\n  keepIconLink: () => false,\n  renderOverlay: null,\n  url: null,\n}\n\nFavicon.propTypes = {\n  iconSize: PropTypes.number,\n  alertCount: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  alertFillColor: PropTypes.string,\n  alertTextColor: PropTypes.string,\n  animated: PropTypes.bool,\n  animationDelay: PropTypes.number,\n  keepIconLink: PropTypes.func,\n  renderOverlay: PropTypes.func,\n  url: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.string),\n    PropTypes.string,\n  ]).isRequired,\n}\n\nexport default Favicon\n"],"mappings":"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","names":["url","PropTypes"]}